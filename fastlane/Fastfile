default_platform(:mac)

platform :mac do
  
  lane :package do |options|
    setup
    build
    clean

  end
  
  
  private_lane :setup do |options|
    set_info_plist_value(path: "#{ENV["APP_NAME"]}/Info.plist", 
      key: "CFBundleShortVersionString", value: ENV["APP_VERSION"],
      key: "CFBundleVersion", value: ENV["APP_VERSION"],
      key: "CommitSHA", value: options[:commit_sha])
  end


  private_lane :build do 
    build_app(
      clean: true,
      silent: true,
      export_method: 'mac-application')
  end

  private_lane :clean do
    sh "rm -vfr ~/Library/Developer/Xcode/Archives/*"
  end


end
